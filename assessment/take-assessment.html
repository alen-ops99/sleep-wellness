<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sleep Assessment | Sleep Wellness by Dr. Alen</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy: #0f1c2e;
            --navy-light: #1a2d47;
            --gold: #C9A962;
            --gold-dark: #a68a4a;
            --cream: #FAF8F5;
            --text: #2c2c2c;
            --text-light: #6b7280;
            --radius-lg: 16px;
            --radius-md: 12px;
            --radius-sm: 8px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
            min-height: 100vh;
            color: var(--text);
        }

        /* Navigation */
        .nav {
            background: rgba(15, 28, 46, 0.95);
            padding: 12px 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(201, 169, 98, 0.2);
        }

        .nav-brand {
            text-decoration: none;
        }

        .nav-brand-main {
            font-family: 'Cormorant Garamond', serif;
            color: var(--cream);
            font-size: 20px;
            letter-spacing: 2px;
            display: block;
        }

        .nav-brand-sub {
            font-size: 10px;
            color: var(--gold);
            letter-spacing: 1px;
        }

        /* Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            min-height: calc(100vh - 60px);
        }

        /* Progress */
        .progress-bar {
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: var(--gold);
            border-radius: 2px;
            transition: width 0.4s ease;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: rgba(255,255,255,0.5);
            margin-bottom: 30px;
        }

        /* Card */
        .card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .card h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 32px;
            color: var(--navy);
            margin-bottom: 10px;
            text-align: center;
        }

        .card .subtitle {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 30px;
            font-size: 14px;
        }

        /* Step hidden by default */
        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        /* Section Title within steps */
        .section-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 22px;
            color: var(--navy);
            margin: 30px 0 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(201, 169, 98, 0.2);
        }

        .section-title:first-child {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        /* Client Type Cards */
        .client-types {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        .client-type {
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-md);
            padding: 25px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .client-type:hover {
            border-color: var(--gold);
            transform: translateY(-3px);
        }

        .client-type.selected {
            border-color: var(--gold);
            background: rgba(201, 169, 98, 0.1);
        }

        .client-type-icon {
            width: 50px;
            height: 50px;
            background: rgba(201, 169, 98, 0.15);
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .client-type-icon svg {
            width: 24px;
            height: 24px;
            color: var(--gold-dark);
        }

        .client-type h3 {
            font-size: 14px;
            color: var(--navy);
            margin-bottom: 5px;
        }

        .client-type p {
            font-size: 11px;
            color: var(--text-light);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--navy);
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #e5e7eb;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--gold);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* Question */
        .question-text {
            font-size: 16px;
            color: var(--navy);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .question-number {
            font-size: 12px;
            color: var(--gold-dark);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        /* Options */
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s;
        }

        .option:hover {
            border-color: var(--gold);
        }

        .option.selected {
            border-color: var(--gold);
            background: rgba(201, 169, 98, 0.1);
        }

        .option-radio {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .option.selected .option-radio {
            border-color: var(--gold);
        }

        .option.selected .option-radio::after {
            content: '';
            width: 10px;
            height: 10px;
            background: var(--gold);
            border-radius: 50%;
        }

        .option-label {
            flex: 1;
            font-size: 14px;
        }

        /* Checkbox Options */
        .option-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .option.selected .option-checkbox {
            border-color: var(--gold);
            background: var(--gold);
        }

        .option.selected .option-checkbox::after {
            content: 'âœ“';
            color: var(--navy);
            font-size: 12px;
            font-weight: bold;
        }

        /* Rating Scale */
        .rating-scale {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .rating-option {
            flex: 1;
            text-align: center;
            padding: 15px 5px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
        }

        .rating-option:hover {
            border-color: var(--gold);
        }

        .rating-option.selected {
            border-color: var(--gold);
            background: var(--gold);
            color: var(--navy);
        }

        .rating-option .number {
            font-size: 18px;
            font-weight: 600;
            display: block;
        }

        .rating-option .label {
            font-size: 10px;
            color: var(--text-light);
        }

        .rating-option.selected .label {
            color: var(--navy);
        }

        /* Frequency Scale */
        .frequency-scale {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .frequency-option {
            text-align: center;
            padding: 12px 8px;
            border: 2px solid #e5e7eb;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }

        .frequency-option:hover {
            border-color: var(--gold);
        }

        .frequency-option.selected {
            border-color: var(--gold);
            background: var(--gold);
            color: var(--navy);
        }

        /* Buttons */
        .btn {
            padding: 14px 30px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--gold);
            color: var(--navy);
        }

        .btn-primary:hover {
            background: #d4b76d;
        }

        .btn-primary:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: transparent;
            color: var(--navy);
            border: 1px solid #e5e7eb;
        }

        .btn-secondary:hover {
            border-color: var(--gold);
        }

        .btn-row {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        /* Results */
        .results-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .score-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gold) 0%, #d4b76d 100%);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cormorant Garamond', serif;
            font-size: 42px;
            color: var(--navy);
        }

        .score-label {
            color: var(--text-light);
            font-size: 14px;
        }

        .findings {
            background: var(--cream);
            border-radius: var(--radius-md);
            padding: 25px;
            margin-bottom: 25px;
        }

        .findings h3 {
            font-size: 16px;
            color: var(--navy);
            margin-bottom: 15px;
        }

        .finding-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .finding-item svg {
            flex-shrink: 0;
            margin-top: 2px;
        }

        .finding-item.warning svg {
            color: #f59e0b;
        }

        .finding-item.good svg {
            color: #10b981;
        }

        .finding-item.info svg {
            color: #3b82f6;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e5e7eb;
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Info Box */
        .info-box {
            background: rgba(201, 169, 98, 0.1);
            border-left: 3px solid var(--gold);
            padding: 15px 20px;
            margin-bottom: 25px;
            font-size: 13px;
            color: var(--text-light);
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        /* Mobile */
        @media (max-width: 600px) {
            .client-types {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .rating-scale {
                flex-wrap: wrap;
            }

            .rating-option {
                flex: 0 0 calc(20% - 8px);
            }

            .frequency-scale {
                grid-template-columns: repeat(3, 1fr);
            }

            .card {
                padding: 25px;
            }
        }
    </style>
</head>
<body>

<!-- Navigation -->
<nav class="nav">
    <a href="../index.html" class="nav-brand">
        <span class="nav-brand-main">SLEEP WELLNESS</span>
        <span class="nav-brand-sub">by Dr. Alen</span>
    </a>
    <a href="account.html" style="color: var(--gold); text-decoration: none; font-size: 13px;">Back to Dashboard</a>
</nav>

<!-- Main Container -->
<div class="container">
    <!-- Progress -->
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>
    <div class="progress-text">
        <span id="stepLabel">Getting Started</span>
        <span id="stepProgress">0%</span>
    </div>

    <!-- Card -->
    <div class="card">
        <!-- Loading State -->
        <div id="loadingState" class="loading">
            <div class="spinner"></div>
            <p style="color: var(--text-light);">Loading assessment...</p>
        </div>

        <!-- Step 1: Welcome -->
        <div class="step" id="step-welcome">
            <h1>Comprehensive Sleep Assessment</h1>
            <p class="subtitle">A physician-designed evaluation of your sleep health</p>

            <div style="text-align: center; margin: 30px 0;">
                <div style="display: flex; justify-content: center; gap: 40px; margin-bottom: 30px;">
                    <div>
                        <div style="font-size: 28px; color: var(--gold); font-family: 'Cormorant Garamond', serif;">20-25</div>
                        <div style="font-size: 12px; color: var(--text-light);">Minutes</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; color: var(--gold); font-family: 'Cormorant Garamond', serif;">10+</div>
                        <div style="font-size: 12px; color: var(--text-light);">Screenings</div>
                    </div>
                    <div>
                        <div style="font-size: 28px; color: var(--gold); font-family: 'Cormorant Garamond', serif;">100%</div>
                        <div style="font-size: 12px; color: var(--text-light);">Private</div>
                    </div>
                </div>
            </div>

            <div style="background: var(--cream); padding: 20px; border-radius: var(--radius-md); margin-bottom: 20px;">
                <p style="font-size: 14px; color: var(--text-light); margin: 0;">
                    This comprehensive assessment screens for all major sleep disorders including insomnia,
                    sleep apnea, restless legs syndrome, narcolepsy, parasomnias, and more. Your detailed
                    results will help Dr. Alen provide personalized recommendations.
                </p>
            </div>

            <!-- Legal Disclaimer -->
            <div style="background: rgba(15, 28, 46, 0.03); border: 1px solid rgba(15, 28, 46, 0.1); padding: 18px 20px; border-radius: var(--radius-md); margin-bottom: 25px;">
                <p style="font-size: 12px; color: var(--text-light); margin: 0 0 10px 0; line-height: 1.6;">
                    <strong style="color: var(--navy);">Important Notice:</strong> This assessment is for informational and educational purposes only and does not constitute medical advice, diagnosis, or treatment. Sleep Wellness by Dr. Alen is a consulting service, not a medical practice. The information gathered is used to provide personalized sleep wellness guidance.
                </p>
                <p style="font-size: 12px; color: var(--text-light); margin: 0 0 10px 0; line-height: 1.6;">
                    Always consult with a qualified healthcare provider regarding any medical conditions or before making changes to your health regimen. If you are experiencing a medical emergency, please contact emergency services immediately.
                </p>
                <p style="font-size: 12px; color: var(--text-light); margin: 0; line-height: 1.6;">
                    <strong style="color: var(--navy);">Your Comfort Matters:</strong> You may skip any question you prefer not to answer. All responses are optional and kept strictly confidential. The goal is to gain a comprehensive understanding of your sleep to provide the best possible guidance.
                </p>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="startAssessment()">Begin Assessment</button>
                <p style="font-size: 11px; color: var(--text-light); margin-top: 12px;">
                    By proceeding, you acknowledge that you have read and understood the above notice.
                </p>
            </div>
        </div>

        <!-- Step 2: Client Type -->
        <div class="step" id="step-clientType">
            <h1>How Would You Describe Yourself?</h1>
            <p class="subtitle">This helps us tailor recommendations to your specific needs</p>

            <div class="client-types">
                <div class="client-type" onclick="selectClientType('athlete')">
                    <div class="client-type-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 2a10 10 0 0 1 0 20M12 2a10 10 0 0 0 0 20M2 12h20"/>
                        </svg>
                    </div>
                    <h3>Elite Athlete</h3>
                    <p>Professional or competitive athlete</p>
                </div>
                <div class="client-type" onclick="selectClientType('executive')">
                    <div class="client-type-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="2" y="3" width="20" height="14" rx="2"/>
                            <path d="M8 21h8M12 17v4"/>
                        </svg>
                    </div>
                    <h3>Corporate Executive</h3>
                    <p>Business leader seeking peak performance</p>
                </div>
                <div class="client-type" onclick="selectClientType('hotel')">
                    <div class="client-type-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M3 21h18M3 10h18M3 7l9-4 9 4M4 10v11M20 10v11"/>
                        </svg>
                    </div>
                    <h3>Hotel Guest</h3>
                    <p>Traveler seeking better sleep</p>
                </div>
            </div>
        </div>

        <!-- Step 3: Demographics -->
        <div class="step" id="step-demographics">
            <h1>Basic Information</h1>
            <p class="subtitle">This helps us provide accurate assessments</p>

            <div class="form-row">
                <div class="form-group">
                    <label>Age</label>
                    <input type="number" id="age" min="18" max="100" placeholder="Enter your age">
                </div>
                <div class="form-group">
                    <label>Sex</label>
                    <select id="gender">
                        <option value="">Select...</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other / Prefer not to say</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Height (cm)</label>
                    <input type="number" id="height" min="100" max="250" placeholder="e.g., 175">
                </div>
                <div class="form-group">
                    <label>Weight (kg)</label>
                    <input type="number" id="weight" min="30" max="300" placeholder="e.g., 70">
                </div>
            </div>
            <div class="form-group">
                <label>Occupation</label>
                <input type="text" id="occupation" placeholder="e.g., Software Engineer, Physician, Athlete">
            </div>
            <div class="form-group">
                <label>Do you do shift work or have irregular work hours?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectOption('shiftWork', 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectOption('shiftWork', 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('clientType')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('goals')">Continue</button>
            </div>
        </div>

        <!-- Step 4: Sleep Goals -->
        <div class="step" id="step-goals">
            <h1>Your Sleep Goals</h1>
            <p class="subtitle">What would you like to achieve?</p>

            <div class="form-group">
                <label>What is your primary reason for seeking sleep help? (select all that apply)</label>
                <div class="options" id="goalOptions">
                    <div class="option" onclick="toggleMultiSelect('goals', 'fall_asleep', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Difficulty falling asleep</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('goals', 'stay_asleep', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Waking up during the night</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('goals', 'early_waking', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Waking up too early</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('goals', 'unrefreshed', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Not feeling refreshed after sleep</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('goals', 'daytime_sleepiness', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Excessive daytime sleepiness</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('goals', 'snoring', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Snoring or breathing issues</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('goals', 'performance', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Optimizing performance</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('goals', 'jet_lag', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Managing jet lag / travel</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>How long have you been experiencing sleep problems?</label>
                <select id="problemDuration">
                    <option value="">Select duration...</option>
                    <option value="less_than_month">Less than 1 month</option>
                    <option value="1_3_months">1-3 months</option>
                    <option value="3_6_months">3-6 months</option>
                    <option value="6_12_months">6-12 months</option>
                    <option value="1_3_years">1-3 years</option>
                    <option value="more_than_3_years">More than 3 years</option>
                </select>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('demographics')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('sleepSchedule')">Continue</button>
            </div>
        </div>

        <!-- Step 5: Sleep Schedule -->
        <div class="step" id="step-sleepSchedule">
            <h1>Your Sleep Schedule</h1>
            <p class="subtitle">Tell us about your typical sleep patterns</p>

            <div class="form-row">
                <div class="form-group">
                    <label>Typical Bedtime</label>
                    <input type="time" id="bedtime" value="23:00">
                </div>
                <div class="form-group">
                    <label>Typical Wake Time</label>
                    <input type="time" id="waketime" value="07:00">
                </div>
            </div>
            <div class="form-group">
                <label>How long does it take you to fall asleep? (minutes)</label>
                <input type="number" id="sleepLatency" min="0" max="180" placeholder="e.g., 15">
            </div>
            <div class="form-group">
                <label>How many times do you wake up during the night?</label>
                <select id="awakenings">
                    <option value="0">0 - I sleep through</option>
                    <option value="1">1 time</option>
                    <option value="2">2 times</option>
                    <option value="3">3 times</option>
                    <option value="4">4 or more times</option>
                </select>
            </div>
            <div class="form-group">
                <label>How would you rate your overall sleep quality?</label>
                <div class="rating-scale" id="sleepQuality">
                    <div class="rating-option" onclick="selectRating('sleepQuality', 1)">
                        <span class="number">1</span>
                        <span class="label">Very Poor</span>
                    </div>
                    <div class="rating-option" onclick="selectRating('sleepQuality', 2)">
                        <span class="number">2</span>
                        <span class="label">Poor</span>
                    </div>
                    <div class="rating-option" onclick="selectRating('sleepQuality', 3)">
                        <span class="number">3</span>
                        <span class="label">Fair</span>
                    </div>
                    <div class="rating-option" onclick="selectRating('sleepQuality', 4)">
                        <span class="number">4</span>
                        <span class="label">Good</span>
                    </div>
                    <div class="rating-option" onclick="selectRating('sleepQuality', 5)">
                        <span class="number">5</span>
                        <span class="label">Excellent</span>
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('goals')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('nightWaking')">Continue</button>
            </div>
        </div>

        <!-- Step 6: Night Waking Reasons -->
        <div class="step" id="step-nightWaking">
            <h1>Night Awakenings</h1>
            <p class="subtitle">If you wake up at night, what usually causes it?</p>

            <div class="info-box">
                Understanding why you wake up helps identify specific issues. Select all that apply.
            </div>

            <div class="form-group">
                <div class="options" id="nightWakingOptions">
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'unknown', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">I don't know / just wake up</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'bathroom', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Need to use the bathroom</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'racing_thoughts', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Racing thoughts / anxiety</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'noise', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Noise or environmental factors</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'pain', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Pain or discomfort</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'breathing', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Difficulty breathing / choking</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'nightmares', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Nightmares or bad dreams</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'legs', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Uncomfortable sensations in legs</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'hot_cold', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Feeling too hot or cold</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('nightWaking', 'partner', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Partner snoring or moving</div>
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('sleepSchedule')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('stress')">Continue</button>
            </div>
        </div>

        <!-- Step 7: Stress Assessment -->
        <div class="step" id="step-stress">
            <h1>Stress & Mental Health</h1>
            <p class="subtitle">Stress significantly impacts sleep quality</p>

            <div class="form-group">
                <label>How would you rate your current stress level?</label>
                <div class="rating-scale" id="stressLevel">
                    <div class="rating-option" onclick="selectRating('stressLevel', 1)">
                        <span class="number">1</span>
                        <span class="label">None</span>
                    </div>
                    <div class="rating-option" onclick="selectRating('stressLevel', 2)">
                        <span class="number">2</span>
                        <span class="label">Mild</span>
                    </div>
                    <div class="rating-option" onclick="selectRating('stressLevel', 3)">
                        <span class="number">3</span>
                        <span class="label">Moderate</span>
                    </div>
                    <div class="rating-option" onclick="selectRating('stressLevel', 4)">
                        <span class="number">4</span>
                        <span class="label">High</span>
                    </div>
                    <div class="rating-option" onclick="selectRating('stressLevel', 5)">
                        <span class="number">5</span>
                        <span class="label">Severe</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Over the past 2 weeks, how often have you felt down, depressed, or hopeless?</label>
                <div class="frequency-scale" id="depression">
                    <div class="frequency-option" onclick="selectFrequency('depression', 0, this)">Not at all</div>
                    <div class="frequency-option" onclick="selectFrequency('depression', 1, this)">Several days</div>
                    <div class="frequency-option" onclick="selectFrequency('depression', 2, this)">More than half the days</div>
                    <div class="frequency-option" onclick="selectFrequency('depression', 3, this)">Nearly every day</div>
                </div>
            </div>

            <div class="form-group">
                <label>Over the past 2 weeks, how often have you felt nervous, anxious, or on edge?</label>
                <div class="frequency-scale" id="anxiety">
                    <div class="frequency-option" onclick="selectFrequency('anxiety', 0, this)">Not at all</div>
                    <div class="frequency-option" onclick="selectFrequency('anxiety', 1, this)">Several days</div>
                    <div class="frequency-option" onclick="selectFrequency('anxiety', 2, this)">More than half the days</div>
                    <div class="frequency-option" onclick="selectFrequency('anxiety', 3, this)">Nearly every day</div>
                </div>
            </div>

            <div class="form-group">
                <label>Do you often lie awake at night worrying?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectOption('worryAtNight', 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectOption('worryAtNight', 'sometimes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Sometimes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectOption('worryAtNight', 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('nightWaking')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('epworth')">Continue</button>
            </div>
        </div>

        <!-- Step 8: Epworth -->
        <div class="step" id="step-epworth">
            <h1>Daytime Sleepiness</h1>
            <p class="subtitle">Epworth Sleepiness Scale - Rate your chance of dozing</p>

            <div class="info-box">
                How likely are you to doze off or fall asleep in the following situations? This refers to your usual way of life in recent times.
            </div>

            <div id="epworthQuestions"></div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('stress')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('isi')">Continue</button>
            </div>
        </div>

        <!-- Step 9: ISI -->
        <div class="step" id="step-isi">
            <h1>Insomnia Severity</h1>
            <p class="subtitle">Rate the severity of your insomnia problems (last 2 weeks)</p>

            <div id="isiQuestions"></div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('epworth')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('stopbang')">Continue</button>
            </div>
        </div>

        <!-- Step 10: STOP-BANG -->
        <div class="step" id="step-stopbang">
            <h1>Sleep Apnea Screening</h1>
            <p class="subtitle">STOP-BANG Questionnaire</p>

            <div class="info-box">
                Sleep apnea is a common but serious condition where breathing repeatedly stops during sleep.
            </div>

            <div id="stopbangQuestions"></div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('isi')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('rls')">Continue</button>
            </div>
        </div>

        <!-- Step 11: Restless Legs Syndrome -->
        <div class="step" id="step-rls">
            <h1>Restless Legs Syndrome</h1>
            <p class="subtitle">Screening for RLS</p>

            <div class="info-box">
                RLS causes uncomfortable sensations in the legs with an urge to move them, especially at rest or at night.
            </div>

            <div class="form-group">
                <label>1. Do you have uncomfortable sensations in your legs with an urge to move them?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectRLS(0, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectRLS(0, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>2. Do these sensations occur mainly at rest or when lying down?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectRLS(1, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectRLS(1, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>3. Are the sensations relieved by movement like walking or stretching?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectRLS(2, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectRLS(2, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>4. Are the sensations worse in the evening or at night?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectRLS(3, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectRLS(3, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>5. If yes to the above, how often do you experience these symptoms?</label>
                <select id="rlsFrequency">
                    <option value="">Select frequency...</option>
                    <option value="rarely">Rarely (less than once a month)</option>
                    <option value="sometimes">Sometimes (1-2 times per week)</option>
                    <option value="often">Often (3-4 times per week)</option>
                    <option value="always">Almost every night</option>
                </select>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('stopbang')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('narcolepsy')">Continue</button>
            </div>
        </div>

        <!-- Step 12: Narcolepsy Screening -->
        <div class="step" id="step-narcolepsy">
            <h1>Narcolepsy Screening</h1>
            <p class="subtitle">Screening for excessive daytime sleepiness disorders</p>

            <div class="info-box">
                Narcolepsy is a neurological disorder affecting the control of sleep and wakefulness.
            </div>

            <div class="form-group">
                <label>1. Do you experience sudden, irresistible episodes of sleep during the day?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(0, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(0, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>2. Have you ever experienced sudden muscle weakness triggered by strong emotions (laughing, surprise, anger)?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(1, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(1, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>3. Do you experience vivid, dream-like hallucinations when falling asleep or waking up?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(2, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(2, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>4. Do you experience sleep paralysis (unable to move when falling asleep or waking)?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(3, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(3, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>5. Do you feel refreshed after a brief nap?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(4, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectNarcolepsy(4, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('rls')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('parasomnias')">Continue</button>
            </div>
        </div>

        <!-- Step 13: Parasomnias & RBD -->
        <div class="step" id="step-parasomnias">
            <h1>Parasomnias & Sleep Behaviors</h1>
            <p class="subtitle">Unusual behaviors during sleep</p>

            <div class="info-box">
                Parasomnias are abnormal behaviors or experiences during sleep. Please indicate if you or your bed partner have noticed any of the following.
            </div>

            <div class="section-title" style="margin-top: 0;">General Parasomnias</div>

            <div class="form-group">
                <label>Have you or your bed partner noticed any of the following? (select all that apply)</label>
                <div class="options" id="parasomniaOptions">
                    <div class="option" onclick="toggleMultiSelect('parasomnias', 'sleepwalking', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Sleepwalking</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('parasomnias', 'sleeptalking', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Sleep talking</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('parasomnias', 'nightmares', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Frequent nightmares</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('parasomnias', 'night_terrors', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Night terrors (screaming, intense fear)</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('parasomnias', 'sleep_eating', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Eating during sleep without awareness</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('parasomnias', 'teeth_grinding', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Teeth grinding (bruxism)</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('parasomnias', 'bedwetting', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Bedwetting</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('parasomnias', 'none', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">None of the above</div>
                    </div>
                </div>
            </div>

            <div class="section-title">REM Sleep Behavior Disorder (RBD)</div>
            <p style="font-size: 13px; color: var(--text-light); margin-bottom: 20px;">
                RBD is a condition where you physically act out vivid dreams during REM sleep.
            </p>

            <div class="form-group">
                <label>1. Have you been told that you act out your dreams while sleeping (punching, kicking, screaming)?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectRBD(0, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectRBD(0, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>2. Have you ever injured yourself or your bed partner during sleep?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectRBD(1, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectRBD(1, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>3. Do you have vivid dreams that you can clearly recall?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectRBD(2, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectRBD(2, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('narcolepsy')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('hypersomnia')">Continue</button>
            </div>
        </div>

        <!-- Step 14: Hypersomnia -->
        <div class="step" id="step-hypersomnia">
            <h1>Excessive Sleep & Fatigue</h1>
            <p class="subtitle">Screening for hypersomnia</p>

            <div class="form-group">
                <label>1. Do you regularly sleep more than 9 hours per night but still feel unrefreshed?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectHypersomnia(0, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectHypersomnia(0, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>2. Do you have extreme difficulty waking up in the morning (sleep inertia)?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectHypersomnia(1, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectHypersomnia(1, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>3. Do you take long naps (1-2+ hours) that don't refresh you?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectHypersomnia(2, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectHypersomnia(2, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>4. Do you experience "brain fog" or cognitive difficulties even after adequate sleep?</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectHypersomnia(3, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectHypersomnia(3, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('parasomnias')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('medical')">Continue</button>
            </div>
        </div>

        <!-- Step 15: Medical History -->
        <div class="step" id="step-medical">
            <h1>Medical & Lifestyle</h1>
            <p class="subtitle">Important context for your sleep health</p>

            <div class="form-group">
                <label>Do you have any of the following conditions? (select all that apply)</label>
                <div class="options" id="medicalOptions">
                    <div class="option" onclick="toggleMultiSelect('medical', 'hypertension', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">High blood pressure</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('medical', 'diabetes', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Diabetes</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('medical', 'heart_disease', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Heart disease</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('medical', 'depression', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Depression</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('medical', 'anxiety_disorder', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Anxiety disorder</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('medical', 'thyroid', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Thyroid disorder</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('medical', 'chronic_pain', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">Chronic pain</div>
                    </div>
                    <div class="option" onclick="toggleMultiSelect('medical', 'none', this)">
                        <div class="option-checkbox"></div>
                        <div class="option-label">None of the above</div>
                    </div>
                </div>
            </div>

            <div class="section-title">Lifestyle Factors</div>

            <div class="form-group">
                <label>How many caffeinated drinks do you have per day?</label>
                <select id="caffeine">
                    <option value="0">None</option>
                    <option value="1">1-2</option>
                    <option value="2">3-4</option>
                    <option value="3">5 or more</option>
                </select>
            </div>

            <div class="form-group">
                <label>Do you consume alcohol?</label>
                <select id="alcohol">
                    <option value="never">Never</option>
                    <option value="rarely">Rarely (special occasions)</option>
                    <option value="weekly">Weekly (1-2 times)</option>
                    <option value="several">Several times per week</option>
                    <option value="daily">Daily</option>
                </select>
            </div>

            <div class="form-group">
                <label>Do you exercise regularly?</label>
                <select id="exercise">
                    <option value="never">No exercise</option>
                    <option value="light">Light (1-2 times/week)</option>
                    <option value="moderate">Moderate (3-4 times/week)</option>
                    <option value="intense">Intense (5+ times/week)</option>
                </select>
            </div>

            <div class="form-group">
                <label>Do you use any sleep medications or supplements?</label>
                <input type="text" id="sleepMeds" placeholder="e.g., Melatonin, Ambien, none">
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('hypersomnia')">Back</button>
                <button class="btn btn-primary" onclick="goToStep('additional')">Continue</button>
            </div>
        </div>

        <!-- Step 16: Additional Notes -->
        <div class="step" id="step-additional">
            <h1>Additional Information</h1>
            <p class="subtitle">Anything else we should know?</p>

            <div class="form-group">
                <label>Is there anything else about your sleep you'd like Dr. Alen to know?</label>
                <textarea id="additionalNotes" rows="5" placeholder="Describe any other sleep concerns, patterns, or questions you have..."></textarea>
            </div>

            <div class="form-group">
                <label>What is the best time for you to have a consultation?</label>
                <select id="preferredTime">
                    <option value="">Select preferred time...</option>
                    <option value="morning">Morning (8am - 12pm)</option>
                    <option value="afternoon">Afternoon (12pm - 5pm)</option>
                    <option value="evening">Evening (5pm - 8pm)</option>
                    <option value="flexible">Flexible</option>
                </select>
            </div>

            <div class="form-group">
                <label>Preferred timezone</label>
                <select id="timezone">
                    <option value="America/New_York">Eastern Time (ET)</option>
                    <option value="America/Chicago">Central Time (CT)</option>
                    <option value="America/Denver">Mountain Time (MT)</option>
                    <option value="America/Los_Angeles">Pacific Time (PT)</option>
                    <option value="Europe/London">London (GMT/BST)</option>
                    <option value="Europe/Paris">Central European (CET)</option>
                    <option value="Europe/Zagreb">Zagreb (CET)</option>
                    <option value="Asia/Dubai">Dubai (GST)</option>
                    <option value="Asia/Tokyo">Tokyo (JST)</option>
                </select>
            </div>

            <div class="btn-row">
                <button class="btn btn-secondary" onclick="goToStep('medical')">Back</button>
                <button class="btn btn-primary" onclick="submitAssessment()">View Results</button>
            </div>
        </div>

        <!-- Step 17: Results -->
        <div class="step" id="step-results">
            <div class="results-header">
                <div class="score-circle" id="overallScore">--</div>
                <h1>Your Sleep Health Score</h1>
                <p class="score-label" id="scoreInterpretation">Calculating...</p>
            </div>

            <div class="findings" id="findingsSection">
                <h3>Key Findings</h3>
                <div id="findingsList"></div>
            </div>

            <div class="findings" id="screeningResults">
                <h3>Screening Results</h3>
                <div id="screeningList"></div>
            </div>

            <div class="findings">
                <h3>Recommendations</h3>
                <div id="recommendationsList"></div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <p style="font-size: 13px; color: var(--text-light); margin-bottom: 20px;">
                    Your comprehensive results have been saved. Dr. Alen will review them and schedule a consultation to discuss personalized recommendations.
                </p>
                <a href="account.html" class="btn btn-primary">Return to Dashboard</a>
            </div>
        </div>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
    // State
    let currentUser = null;
    let currentStep = 'welcome';
    let responses = {
        goals: [],
        nightWaking: [],
        parasomnias: [],
        medical: []
    };

    // Steps in order
    const steps = ['welcome', 'clientType', 'demographics', 'goals', 'sleepSchedule', 'nightWaking', 'stress', 'epworth', 'isi', 'stopbang', 'rls', 'narcolepsy', 'parasomnias', 'hypersomnia', 'medical', 'additional', 'results'];

    // Epworth questions
    const epworthQuestions = [
        "Sitting and reading",
        "Watching TV",
        "Sitting inactive in a public place (e.g., theater or meeting)",
        "As a passenger in a car for an hour without a break",
        "Lying down to rest in the afternoon",
        "Sitting and talking to someone",
        "Sitting quietly after lunch without alcohol",
        "In a car, while stopped for a few minutes in traffic"
    ];

    // ISI questions
    const isiQuestions = [
        { text: "Difficulty falling asleep", options: ["None", "Mild", "Moderate", "Severe", "Very Severe"] },
        { text: "Difficulty staying asleep", options: ["None", "Mild", "Moderate", "Severe", "Very Severe"] },
        { text: "Problems waking up too early", options: ["None", "Mild", "Moderate", "Severe", "Very Severe"] },
        { text: "How satisfied are you with your current sleep pattern?", options: ["Very Satisfied", "Satisfied", "Moderately Satisfied", "Dissatisfied", "Very Dissatisfied"] },
        { text: "How noticeable to others is your sleep problem?", options: ["Not at all", "A Little", "Somewhat", "Much", "Very Much"] },
        { text: "How worried are you about your current sleep problem?", options: ["Not at all", "A Little", "Somewhat", "Much", "Very Much"] },
        { text: "How much does your sleep problem interfere with daily functioning?", options: ["Not at all", "A Little", "Somewhat", "Much", "Very Much"] }
    ];

    // STOP-BANG questions
    const stopbangQuestions = [
        "Do you SNORE loudly (louder than talking or loud enough to be heard through closed doors)?",
        "Do you often feel TIRED, fatigued, or sleepy during daytime?",
        "Has anyone OBSERVED you stop breathing during your sleep?",
        "Do you have or are you being treated for high blood PRESSURE?",
        "Is your neck circumference greater than 40 cm (16 inches)?"
    ];

    // Auth check
    auth.onAuthStateChanged(async (user) => {
        if (!user) {
            window.location.href = 'auth.html?redirect=' + encodeURIComponent(window.location.href);
            return;
        }
        currentUser = user;
        initializeAssessment();
    });

    function initializeAssessment() {
        document.getElementById('loadingState').style.display = 'none';
        document.getElementById('step-welcome').classList.add('active');

        renderEpworth();
        renderISI();
        renderStopBang();

        updateProgress();
    }

    function renderEpworth() {
        const container = document.getElementById('epworthQuestions');
        const options = ["Would never doze (0)", "Slight chance (1)", "Moderate chance (2)", "High chance (3)"];

        container.innerHTML = epworthQuestions.map((q, i) => `
            <div class="form-group">
                <label>${i + 1}. ${q}</label>
                <div class="options">
                    ${options.map((opt, val) => `
                        <div class="option" onclick="selectEpworth(${i}, ${val}, this)">
                            <div class="option-radio"></div>
                            <div class="option-label">${opt}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `).join('');
    }

    function renderISI() {
        const container = document.getElementById('isiQuestions');

        container.innerHTML = isiQuestions.map((q, i) => `
            <div class="form-group">
                <label>${i + 1}. ${q.text}</label>
                <div class="options">
                    ${q.options.map((opt, val) => `
                        <div class="option" onclick="selectISI(${i}, ${val}, this)">
                            <div class="option-radio"></div>
                            <div class="option-label">${opt}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `).join('');
    }

    function renderStopBang() {
        const container = document.getElementById('stopbangQuestions');

        container.innerHTML = stopbangQuestions.map((q, i) => `
            <div class="form-group">
                <label>${i + 1}. ${q}</label>
                <div class="options" style="flex-direction: row; gap: 15px;">
                    <div class="option" style="flex: 1;" onclick="selectStopBang(${i}, 'yes', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">Yes</div>
                    </div>
                    <div class="option" style="flex: 1;" onclick="selectStopBang(${i}, 'no', this)">
                        <div class="option-radio"></div>
                        <div class="option-label">No</div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function startAssessment() {
        goToStep('clientType');
    }

    function selectClientType(type) {
        responses.clientType = type;
        document.querySelectorAll('.client-type').forEach(el => el.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        setTimeout(() => goToStep('demographics'), 300);
    }

    function selectOption(field, value, element) {
        responses[field] = value;
        const parent = element.closest('.form-group');
        parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
    }

    function toggleMultiSelect(field, value, element) {
        if (!responses[field]) responses[field] = [];

        if (value === 'none') {
            responses[field] = ['none'];
            const parent = element.closest('.form-group');
            parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
        } else {
            responses[field] = responses[field].filter(v => v !== 'none');

            const index = responses[field].indexOf(value);
            if (index > -1) {
                responses[field].splice(index, 1);
                element.classList.remove('selected');
            } else {
                responses[field].push(value);
                element.classList.add('selected');
            }

            const noneOption = element.closest('.form-group').querySelector('.option:last-child');
            if (noneOption) noneOption.classList.remove('selected');
        }
    }

    function selectRating(field, value) {
        responses[field] = value;
        const container = document.getElementById(field);
        container.querySelectorAll('.rating-option').forEach((el, i) => {
            el.classList.toggle('selected', i + 1 === value);
        });
    }

    function selectFrequency(field, value, element) {
        responses[field] = value;
        const parent = element.closest('.frequency-scale');
        parent.querySelectorAll('.frequency-option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
    }

    function selectEpworth(qIndex, value, element) {
        if (!responses.epworth) responses.epworth = [];
        responses.epworth[qIndex] = value;

        const parent = element.closest('.form-group');
        parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
    }

    function selectISI(qIndex, value, element) {
        if (!responses.isi) responses.isi = [];
        responses.isi[qIndex] = value;

        const parent = element.closest('.form-group');
        parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
    }

    function selectStopBang(qIndex, value, element) {
        if (!responses.stopbang) responses.stopbang = [];
        responses.stopbang[qIndex] = value;

        const parent = element.closest('.form-group');
        parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
    }

    function selectRLS(qIndex, value, element) {
        if (!responses.rls) responses.rls = [];
        responses.rls[qIndex] = value;

        const parent = element.closest('.form-group');
        parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
    }

    function selectNarcolepsy(qIndex, value, element) {
        if (!responses.narcolepsy) responses.narcolepsy = [];
        responses.narcolepsy[qIndex] = value;

        const parent = element.closest('.form-group');
        parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
    }

    function selectRBD(qIndex, value, element) {
        if (!responses.rbd) responses.rbd = [];
        responses.rbd[qIndex] = value;

        const parent = element.closest('.form-group');
        parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
    }

    function selectHypersomnia(qIndex, value, element) {
        if (!responses.hypersomnia) responses.hypersomnia = [];
        responses.hypersomnia[qIndex] = value;

        const parent = element.closest('.form-group');
        parent.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
    }

    function goToStep(stepName) {
        collectFormData();

        document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
        document.getElementById('step-' + stepName).classList.add('active');
        currentStep = stepName;

        updateProgress();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function collectFormData() {
        // Demographics
        const fields = ['age', 'gender', 'height', 'weight', 'occupation', 'problemDuration',
                        'bedtime', 'waketime', 'sleepLatency', 'awakenings', 'rlsFrequency',
                        'caffeine', 'alcohol', 'exercise', 'sleepMeds', 'additionalNotes',
                        'preferredTime', 'timezone'];

        fields.forEach(field => {
            const el = document.getElementById(field);
            if (el && el.value) {
                if (el.type === 'number') {
                    responses[field] = parseInt(el.value);
                } else {
                    responses[field] = el.value;
                }
            }
        });
    }

    function updateProgress() {
        const stepIndex = steps.indexOf(currentStep);
        const progress = Math.round((stepIndex / (steps.length - 1)) * 100);

        document.getElementById('progressFill').style.width = progress + '%';
        document.getElementById('stepProgress').textContent = progress + '%';

        const labels = {
            welcome: 'Getting Started',
            clientType: 'Your Profile',
            demographics: 'Basic Information',
            goals: 'Sleep Goals',
            sleepSchedule: 'Sleep Schedule',
            nightWaking: 'Night Awakenings',
            stress: 'Stress & Mental Health',
            epworth: 'Daytime Sleepiness',
            isi: 'Insomnia Severity',
            stopbang: 'Sleep Apnea Screening',
            rls: 'Restless Legs',
            narcolepsy: 'Narcolepsy Screening',
            parasomnias: 'Sleep Behaviors',
            hypersomnia: 'Excessive Sleep',
            medical: 'Medical History',
            additional: 'Additional Info',
            results: 'Your Results'
        };
        document.getElementById('stepLabel').textContent = labels[currentStep] || '';
    }

    async function submitAssessment() {
        collectFormData();

        const results = calculateResults();

        try {
            await db.collection('assessments').add({
                userId: currentUser.uid,
                userEmail: currentUser.email,
                responses: responses,
                results: results,
                completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'completed',
                type: 'comprehensive'
            });
            console.log('Assessment saved to Firebase');
        } catch (error) {
            console.error('Error saving assessment:', error);
        }

        displayResults(results);
        goToStep('results');
    }

    function calculateResults() {
        // Epworth Score (0-24)
        const epworthScore = responses.epworth ? responses.epworth.reduce((a, b) => a + (b || 0), 0) : 0;

        // ISI Score (0-28)
        const isiScore = responses.isi ? responses.isi.reduce((a, b) => a + (b || 0), 0) : 0;

        // STOP-BANG Score
        let stopbangScore = responses.stopbang ? responses.stopbang.filter(v => v === 'yes').length : 0;
        if (responses.age && responses.age > 50) stopbangScore++;
        if (responses.gender === 'male') stopbangScore++;
        if (responses.weight && responses.height) {
            const bmi = responses.weight / Math.pow(responses.height / 100, 2);
            if (bmi > 35) stopbangScore++;
        }

        // RLS Score
        const rlsScore = responses.rls ? responses.rls.filter(v => v === 'yes').length : 0;

        // Narcolepsy Score
        const narcolepsyScore = responses.narcolepsy ? responses.narcolepsy.filter(v => v === 'yes').length : 0;

        // RBD Score
        const rbdScore = responses.rbd ? responses.rbd.filter(v => v === 'yes').length : 0;

        // Hypersomnia Score
        const hypersomniaScore = responses.hypersomnia ? responses.hypersomnia.filter(v => v === 'yes').length : 0;

        // Stress/Mental Health Score
        const stressScore = (responses.stressLevel || 0) + (responses.depression || 0) + (responses.anxiety || 0);

        // Calculate overall score
        let overallScore = 100;
        overallScore -= epworthScore * 1.5;
        overallScore -= isiScore * 1.5;
        overallScore -= stopbangScore * 4;
        overallScore -= rlsScore * 3;
        overallScore -= narcolepsyScore * 4;
        overallScore -= rbdScore * 3;
        overallScore -= hypersomniaScore * 3;
        overallScore -= stressScore * 2;
        overallScore = Math.max(0, Math.min(100, Math.round(overallScore)));

        return {
            overall: overallScore,
            epworth: epworthScore,
            isi: isiScore,
            stopbang: stopbangScore,
            rls: rlsScore,
            narcolepsy: narcolepsyScore,
            rbd: rbdScore,
            hypersomnia: hypersomniaScore,
            stress: stressScore,
            sleepQuality: responses.sleepQuality || 3
        };
    }

    function displayResults(results) {
        document.getElementById('overallScore').textContent = results.overall;

        let interpretation = '';
        if (results.overall >= 80) interpretation = 'Excellent sleep health';
        else if (results.overall >= 60) interpretation = 'Good sleep health with room for improvement';
        else if (results.overall >= 40) interpretation = 'Moderate sleep concerns - consultation recommended';
        else interpretation = 'Significant sleep concerns - consultation recommended';

        document.getElementById('scoreInterpretation').textContent = interpretation;

        // Findings
        const findings = [];

        if (results.epworth > 10) {
            findings.push({ type: 'warning', text: `Elevated daytime sleepiness (Epworth: ${results.epworth}/24)` });
        } else {
            findings.push({ type: 'good', text: `Normal daytime alertness (Epworth: ${results.epworth}/24)` });
        }

        if (results.isi >= 15) {
            findings.push({ type: 'warning', text: `Moderate to severe insomnia (ISI: ${results.isi}/28)` });
        } else if (results.isi >= 8) {
            findings.push({ type: 'warning', text: `Mild insomnia symptoms (ISI: ${results.isi}/28)` });
        } else {
            findings.push({ type: 'good', text: `No significant insomnia (ISI: ${results.isi}/28)` });
        }

        if (results.stress >= 6) {
            findings.push({ type: 'warning', text: 'Elevated stress/anxiety levels affecting sleep' });
        }

        document.getElementById('findingsList').innerHTML = findings.map(f => `
            <div class="finding-item ${f.type}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${f.type === 'warning' ? '<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>' : '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>'}
                </svg>
                <span>${f.text}</span>
            </div>
        `).join('');

        // Screening Results
        const screenings = [];

        if (results.stopbang >= 3) {
            screenings.push({ type: 'warning', text: `Sleep Apnea: Elevated risk (STOP-BANG: ${results.stopbang}/8) - Sleep study may be recommended` });
        } else {
            screenings.push({ type: 'good', text: `Sleep Apnea: Low risk (STOP-BANG: ${results.stopbang}/8)` });
        }

        if (results.rls >= 3) {
            screenings.push({ type: 'warning', text: 'Restless Legs Syndrome: Positive screening - further evaluation recommended' });
        } else if (results.rls >= 2) {
            screenings.push({ type: 'info', text: 'Restless Legs Syndrome: Some symptoms present' });
        } else {
            screenings.push({ type: 'good', text: 'Restless Legs Syndrome: No significant symptoms' });
        }

        if (results.narcolepsy >= 3) {
            screenings.push({ type: 'warning', text: 'Narcolepsy: Multiple symptoms present - specialist evaluation recommended' });
        } else if (results.narcolepsy >= 2) {
            screenings.push({ type: 'info', text: 'Narcolepsy: Some symptoms noted' });
        } else {
            screenings.push({ type: 'good', text: 'Narcolepsy: No significant symptoms' });
        }

        if (results.rbd >= 2) {
            screenings.push({ type: 'warning', text: 'REM Behavior Disorder: Positive screening - evaluation recommended' });
        } else {
            screenings.push({ type: 'good', text: 'REM Behavior Disorder: No significant symptoms' });
        }

        if (results.hypersomnia >= 3) {
            screenings.push({ type: 'warning', text: 'Hypersomnia: Symptoms of excessive sleep/fatigue present' });
        } else {
            screenings.push({ type: 'good', text: 'Hypersomnia: No significant symptoms' });
        }

        if (responses.parasomnias && responses.parasomnias.length > 0 && !responses.parasomnias.includes('none')) {
            screenings.push({ type: 'info', text: `Parasomnias: ${responses.parasomnias.join(', ').replace(/_/g, ' ')}` });
        }

        document.getElementById('screeningList').innerHTML = screenings.map(s => `
            <div class="finding-item ${s.type}">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${s.type === 'warning' ? '<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>' :
                      s.type === 'info' ? '<circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>' :
                      '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>'}
                </svg>
                <span>${s.text}</span>
            </div>
        `).join('');

        // Recommendations
        const recommendations = [];

        if (results.epworth > 10) {
            recommendations.push('Consider evaluation for underlying causes of excessive daytime sleepiness');
        }
        if (results.isi >= 8) {
            recommendations.push('Cognitive Behavioral Therapy for Insomnia (CBT-I) is the gold standard treatment');
        }
        if (results.stopbang >= 3) {
            recommendations.push('A sleep study (polysomnography) is recommended to evaluate for sleep apnea');
        }
        if (results.rls >= 3) {
            recommendations.push('Iron studies and evaluation for RLS treatment options');
        }
        if (results.stress >= 6) {
            recommendations.push('Stress management and relaxation techniques may improve sleep');
        }
        if (responses.sleepLatency && responses.sleepLatency > 30) {
            recommendations.push('Practice sleep hygiene: consistent bedtime, avoid screens 1 hour before bed');
        }
        if (responses.caffeine && parseInt(responses.caffeine) >= 2) {
            recommendations.push('Consider reducing caffeine intake, especially after 2pm');
        }
        if (responses.alcohol === 'daily' || responses.alcohol === 'several') {
            recommendations.push('Alcohol disrupts sleep architecture - consider reducing consumption');
        }

        if (recommendations.length === 0) {
            recommendations.push('Continue maintaining your healthy sleep habits');
            recommendations.push('Regular exercise and consistent sleep schedule are key to optimal sleep');
        }

        document.getElementById('recommendationsList').innerHTML = recommendations.map(r => `
            <div class="finding-item good">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                </svg>
                <span>${r}</span>
            </div>
        `).join('');
    }
</script>

</body>
</html>
